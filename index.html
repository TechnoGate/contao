<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen"/>
  <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>

  <title>Contao</title>
  <meta name="description" content="Contao Integration with Rails Asset Pipeline, Compass and Capistrano">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">Contao</h1>
    </header>
    <div id="container">
      <p class="tagline">Contao Integration with Rails Asset Pipeline, Compass and Capistrano</p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          <a href="https://github.com/TechnoGate/contao/tarball/master" class="download-button tar"><span>Download</span></a>
          <a href="https://github.com/TechnoGate/contao/zipball/master" class="download-button zip"><span>Download</span></a>
          <a href="https://github.com/TechnoGate/contao" class="code">View Contao on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
          <h1>Contao</h1>

<p>Welcome to Contao!
<a href="http://travis-ci.org/TechnoGate/contao"><img src="https://secure.travis-ci.org/TechnoGate/contao.png?branch=master" alt="Build
Status"></a>
<a href="https://gemnasium.com/TechnoGate/contao"><img src="https://gemnasium.com/TechnoGate/contao.png" alt="Gemnasium"></a></p>

<p>This gem will help you to quickly develop a website using <a href="http://www.contao.org/en/">Contao
CMS</a> which has pre-built support for
<a href="http://sass-lang.com">Sass</a>, <a href="http://compass-style.org">Compass</a>,
<a href="http://coffeescript.org">CoffeeScript</a>,
<a href="http://pivotal.github.com/jasmine/">Jasmine</a> and
<a href="https://github.com/capistrano/capistrano">Capistrano</a>.</p>

<p>It also feature hashed assets served by the <a href="https://github.com/TechnoGate/contao_assets">Contao Assets
extension</a>, which allows you
to have an md5 appended to each of your assets URL on the production
site.</p>

<div class="highlight">
<pre><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"/resources/application-c6e2457d9ccce0f344c50e5bcc12fcdc.css"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"/resources/application-327af3660470fb1c3f8e6593670cfc1e.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre>
</div>


<p>All the images references by the CSS file, are also hashed, so when you
deploy a new version of your image and/or your CSS, you are absolutely
sure that your visitors do not get a cached copy of your old asset.</p>

<div class="highlight">
<pre><span class="nt">div</span>
  <span class="nd">+background</span><span class="p">(</span><span class="nf">image-url</span><span class="p">(</span><span class="s1">'</span><span class="s2">body.jpg'</span><span class="p">)</span> <span class="no">no-repeat</span> <span class="no">top</span> <span class="no">center</span><span class="p">)</span>
</pre>
</div>


<p>Would generate:</p>

<div class="highlight">
<pre><span class="nt">div</span> <span class="p">{</span>
  <span class="k">background</span><span class="o">:</span> <span class="sx">url(/resources/body-fc4a0f5f0b0f9ceec32bde5d15928467.jpg)</span> <span class="k">no-repeat</span> <span class="k">top</span> <span class="k">center</span><span class="p">;</span>
<span class="p">}</span>
</pre>
</div>


<p>Compass gives great power over your CSS, one most-wanted feature is the
sprites, so having one PNG file for all your backgrounds is just
awesome, the generate CSS looks like this</p>

<div class="highlight">
<pre><span class="nt">div</span>
  <span class="nd">+background</span><span class="p">(</span><span class="nf">sprite</span><span class="p">(</span><span class="nv">$background</span><span class="o">,</span> <span class="n">body</span><span class="p">))</span>
</pre>
</div>


<p>Would generate:</p>

<div class="highlight">
<pre><span class="nt">div</span> <span class="p">{</span>
  <span class="k">background</span><span class="o">:</span> <span class="sx">url(/resources/background-sbd69a8307b-a00c8f7a8536397c6279726316eae16f.png)</span> <span class="m">0</span> <span class="m">-3089px</span><span class="p">;</span>
<span class="p">}</span>
</pre>
</div>


<p>Check <a href="http://compass-style.org/help/tutorials/spriting">Compass Sprites
Documentation</a></p>

<p>Finally, the integration with Capistrano allows you to quickly deploy,
copy assets, import database and even upload media such as images and
PDFs all from the command line using Capistrano.</p>

<h2>Pre-requisites</h2>

<p>Before installing the gem, you need to make you are running on a Ruby
version 1.9.2 or greater as this Gem and most of it's dependencies do
not support Ruby 1.8, to check the version you are running, using the
following command:</p>

<div class="highlight">
<pre>ruby --version
</pre>
</div>


<p>If you're running a ruby version below 1.9, please install a 1.9 version
by following the guide at the <a href="https://github.com/fesplugas/rbenv-installer">Rbenv
Installer</a> project.</p>

<p>Contao depends on Qt (for headless javascript testing using
<a href="https://github.com/pivotal/jasmine">jasmine</a> and
<a href="http://johnbintz.github.com/jasmine-headless-webkit">jasmine-headless-webkit</a>,
to install it, refer to <a href="https://github.com/thoughtbot/capybara-webkit/wiki/Installing-Qt-and-compiling-capybara-webkit">Capybara Webkit
Installation</a></p>

<h2>Installation</h2>

<p>Install contao with the following command</p>

<div class="highlight">
<pre><span class="n">gem</span> <span class="n">install</span> <span class="n">contao</span>
</pre>
</div>


<p>Don't forget to run <code>rbenv rehash</code> if you are using
<strong><a href="https://github.com/sstephenson/rbenv">rbenv</a></strong> as this gem provides
an executable.</p>

<h2>Database name</h2>

<p>Locally, the database name is the same as the application name, so if
you named your project is named <strong>my_project</strong>, the database name will be
named <strong>my_project</strong>.</p>

<p>On the server, Capistrano will append the environment on which the
deployment occured (check the deployment section below for more
information) to the application name, so if your project is named
<strong>my_project</strong> and you are deployment to the staging environment, the
database name would default to <strong>my_project_staging</strong></p>

<h2>Usage</h2>

<h3>Generating a config file</h3>

<p>To start using contao, you need to generate a config file, issue the
command</p>

<div class="highlight">
<pre>contao generate config
</pre>
</div>


<p>and follow the on-screen instructions.</p>

<h3>Generate a new project</h3>

<p>Generating a new project is very easy, just use the following command:</p>

<div class="highlight">
<pre>contao new /path/to/my_project
</pre>
</div>


<p>This command will generate an application called <code>my_project</code> in the
folder <code>/path/to</code>, the application name is very important as it defaults
to the name of your database, check the <a href="#database-name">Database name</a>
section below for more information.</p>

<h3>Initialising the project</h3>

<p>Once the project generator has completed, cd into the newsly created
project and bootstrap contao by running</p>

<div class="highlight">
<pre>bundle <span class="nb">exec </span>rake contao:bootstrap
</pre>
</div>


<p>Now visit <code>/contao/install.php</code> or just visit the website and you should
be redirected to the Installation script, from here on it is the usual
Contao installation procedure, please check <a href="http://www.contao.org/en/installing-contao.html#install-tool">Contao's user
guide</a> for
detailed information</p>

<h3>Work on the project</h3>

<p>To be able to develop with this version of Contao, you first need to
understand how it actually works, take a look at the <a href="#project-structure">project
structure</a> for more information on how files are
organised</p>

<p>Contao is integrated with Rails, actually only the asset pipeline
functionality is being used, Compass is also integrated with the project
so you can develop your CSS using Compass functions and mixins as well
as sprites.</p>

<p>To start working on the project, you need to run the rails server by
running</p>

<div class="highlight">
<pre>bundle <span class="nb">exec </span>foreman start
</pre>
</div>


<p>This will start a rails process on port <strong>9876</strong> and serve the assets
from their, The <a href="https://github.com/TechnoGate/contao_assets">Contao Assets
Extension</a> automatically
detect that you are running in development and will use assets from the
rails server directly.</p>

<h2>Deploying</h2>

<h3>Introduction</h3>

<p>Before deploying the project, you need to edit Capistrano config files
located at <code>config/deploy.rb</code> and <code>config/deploy/development.rb</code>.</p>

<p>For a standard project tracked by <a href="http://git-scm.com">Git</a>, you do not
need to edit the file <code>config/deploy.rb</code> but you <strong>do need</strong> to edit
<code>config/deploy/development.rb</code> which is auto-documented.</p>

<h3>Multistage</h3>

<p>Capistrano comes with support for multiple stages, you could have
<code>development</code>, <code>staging</code>, <code>production</code> or any other stage, all you need
to have is the stage name mentioned in <code>config/deploy.rb</code></p>

<div class="highlight">
<pre><span class="n">set</span> <span class="ss">:stages</span><span class="p">,</span> <span class="o">[</span><span class="s1">'development'</span><span class="p">,</span> <span class="s1">'staging'</span><span class="p">,</span> <span class="s1">'production'</span><span class="o">]</span>
</pre>
</div>


<p>and a config file by the same name of the stage located at
<code>config/deploy/</code>, the Template is pre-configured for <strong>development</strong>,
<strong>staging</strong> and <strong>production</strong> but comes with only one config file
for <strong>development</strong>, to configure another stage just duplicate the
<strong>development</strong> file to the desired stage.</p>

<h3>Deploying</h3>

<h4>Provisioning the server</h4>

<p>To deploy your project, you need to first configure the server, if you
are deploying to a server managed by yourself and using <strong>Nginx</strong>
(Apache templates will be added later), you can generate a config file
for your new site, add a user to the database and create the database
using the following command:</p>

<pre lang="shell"><code>bundle exec cap development deploy:server:setup
</code></pre>

<p>The above step is optional and only useful if you manage your own
server, but if you are using a shared server (Hosting), running that
command would not be possible as you don't have root access.</p>

<p>NOTE: This command must be used only once per stage per project.</p>

<h4>Setup the project</h4>

<p>Before deploying you need to setup the project structure, generate the
<strong>localconfig.php</strong>, and the <strong>.htaccess</strong>, to do that just run</p>

<pre lang="shell"><code>bundle exec cap development deploy:setup
</code></pre>

<p>NOTE: This command must be used only once per stage per project.</p>

<h4>Deploy the project</h4>

<p>To deploy the project simply run</p>

<pre lang="shell"><code>bundle exec cap development deploy
</code></pre>

<h4>Multistage</h4>

<p>As you may have noticed, all the above commands had the <strong>development</strong>
stage as the first argument (first argument to <strong>cap</strong>), to deploy to
any other stage just use that stage's name instead.</p>

<p>The contao template comes pre-configured with <strong>development</strong> as the
<strong>default stage</strong></p>

<div class="highlight">
<pre><span class="n">set</span> <span class="ss">:default_stage</span><span class="p">,</span> <span class="ss">:development</span>
</pre>
</div>


<p>So if you omit the stage (the first argument) when calling <strong>cap</strong></p>

<pre lang="shell"><code>bundle exec cap deploy
</code></pre>

<p>The stage would be set to whatever <code>default_stage</code> is set to, in this
case <strong>development</strong></p>

<h2>Useful Capistrano Tasks</h2>

<h3>Database import/export</h3>

<p>You do not need to use SSH or phpMyAdmin to export or import a database
dump, in fact capistrano already knows the credentials to access the
database, so We added a few tasks to help ease this process.</p>

<h4>Importing a database dump</h4>

<p>To import a database dump, which is very useful for deploying a website
that was in development on your localhost, you can use the task
<code>db:import</code> (Remember that all the following commands can
optionally take the stage as the first argument, when omited the stage
is set to the <code>default_stage</code>). To import <code>/path/to/project.sql</code> for
example, you only have to use the command</p>

<pre lang="shell"><code>bundle exec cap db:import /path/to/project.sql
</code></pre>

<p>The above command will first backup your database on the server (check
<code>/backups</code> relative to your project directory of course), and then
import the project.sql into it, however it's up to you to make sure your
SQL dump file has <code>DROP TABLE IF EXISTS</code> statements to overwrite the
tables.</p>

<h4>Exporting a database dump</h4>

<p>To export a database dump, which is very useful to import changes from
the server to your local development machine</p>

<pre lang="shell"><code>bundle exec cap db:export
</code></pre>

<p>This file will download the SQL dump file to a random file in <code>/tmp</code> but
you can optionally give it an argument which would be used as a
filename. This command will also backup the database on the server.</p>

<h3>Content import/export</h3>

<h4>Importing content</h4>

<p>TODO: Write this section.</p>

<h4>Exporting content</h4>

<p>TODO: Write this section.</p>

<h2>Contributing</h2>

<ol>
<li>Fork it</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Added some feature'</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create new Pull Request</li>
</ol><p>Or</p>

<p><a href="http://www.pledgie.com/campaigns/16123"><img src="http://pledgie.com/campaigns/16123.png?skin_name=chrome" alt="Click here to lend your support to: Open Source Projects and make a donation at www.pledgie.com!"></a></p>

<h2>Contact</h2>

<p>For bugs and feature request, please use <strong>Github issues</strong>, for other
requests, you may use:</p>

<ul>
<li>Email: <a href="mailto:contact@technogate.fr">contact@technogate.fr</a>
</li>
</ul><p>Don't forget to follow me on <a href="https://github.com/eMxyzptlk">Github</a> and
<a href="https://twitter.com/eMxyzptlk">Twitter</a> for news and updates.</p>

<h2>Credits</h2>

<p>I'd like to give a special thanks to the guys at <a href="http://www.agence-durable.com">Agence
Durable</a> for supporting and testing this
project, <a href="https://github.com/leofeyer">Leo Feyer</a> for creating an
awesome and easy to use CMS, and of course all Contao contributors, and
Finally The <a href="http://rubyonrails.org/core">Rails Core Team</a> and the
entire Ruby community which are simply <strong>awesome</strong>.</p>

<h2>TODO</h2>

<ul>
<li>The <code>contao</code> folder is a mess and can become a lot messier pretty
quickly so we need to extract each extension into it's folder (make it
modularized)</li>
<li>Add Capistrano tasks for Starting/Stopping/Reloading Nginx</li>
<li>Add Capistrano support for Apache</li>
<li>The install password should be different for each website and the
developer should be able to modify it, Basically the install password
in <code>~/.contao/config.yml</code> should be stored in clear-text (or encrypted
but decryptable), and once we generate a new project we should generate
a new salt, store it in an initializer, generate the install password
and store it in an initializer as well</li>
<li>A new rake task should be created to help the user easly modify the
install password</li>
<li>The <strong>encryption_key</strong> should be generated for each project and not
stored in the <code>~/.contao/config.yml</code>
</li>
<li>The assets takes a considerably amount of time to be uploaded,
specially if you have many images, we should compress the entire
folder, upload it and then extract it on the server, as it would be
much faster to upload one file.</li>
</ul><h2>Project structure</h2>

<pre lang="shell"><code>contao_template
├── Capfile
├── Gemfile
├── Procfile
├── Rakefile
├── app
│   └── assets
│       ├── images
│       ├── javascripts
│       │   └── application.js
│       └── stylesheets
│           ├── application.css.sass
│           ├── definitions
│           │   ├── _all.sass
│           │   ├── _mixins.sass
│           │   ├── _sprites.sass
│           │   └── _variables.sass
│           └── thirdparty
│               └── _pie.sass
├── config
│   ├── application.rb
│   ├── boot.rb
│   ├── compass.rb
│   ├── deploy
│   │   ├── development.rb
│   │   └── production.rb
│   ├── deploy.rb
│   ├── environment.rb
│   ├── environments
│   │   ├── development.rb
│   │   ├── production.rb
│   │   └── test.rb
│   ├── examples
│   │   └── localconfig.php.erb
│   ├── initializers
│   │   ├── secret_token.rb
│   │   └── session_store.rb
│   └── routes.rb
├── config.ru
├── contao
│   ├── plugins
│   ├── system
│   │   ├── drivers
│   │   ├── libraries
│   │   │   ├── Spyc.php -&gt; ../../../lib/contao/libraries/spyc/spyc.php
│   │   └── modules
│   │       ├── BackupDB
│   │       ├── assets
│   │       ├── efg
│   │       ├── favicon
│   │       ├── googleanalytics
│   │       ├── listing
│   │       ├── parentslist
│   │       ├── subcolumns
│   │       ├── template-override
│   │       ├── videobox
│   │       └── videobox_vimeo
├── lib
│   ├── assets
│   │   └── javascripts
│   │       ├── form_default_values
│   │       │   ├── autoload.js.coffee
│   │       │   └── main.js.coffee
│   │       ├── form_default_values.js
│   │       └── slider.js.coffee
│   ├── contao
│   │   └── libraries
│   │       └── spyc
│   └── tasks
├── public
├── script
│   └── rails
├── spec
│   └── javascripts
│       ├── fixtures
│       │   └── slider.html
│       ├── helpers
│       │   └── spec_helper.js.coffee
│       ├── slider_spec.coffee
│       └── support
│           └── jasmine.yml
└── vendor
    └── assets
        ├── javascripts
        └── stylesheets
</code></pre>

<h2>License</h2>

<h3>This code is free to use under the terms of the MIT license.</h3>

<p>Copyright (c) 2011 TechnoGate &lt;<a href="mailto:support@technogate.fr">support@technogate.fr</a>&gt;</p>

<p>Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      <p><a href="https://github.com/TechnoGate" class="avatar"><img src="https://secure.gravatar.com/avatar/487dd0ef8d9cc22e8443df53db2a8621?s=30&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png" width="48" height="48"/></a> <a href="https://github.com/TechnoGate">TechnoGate</a> maintains <a href="https://github.com/TechnoGate/contao">Contao</a></p>


      </div>
      <div class="creds">
        <small>This page generated using <a href="https://pages.github.com/">GitHub Pages</a><br/>theme by <a href="http://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/TechnoGate/contao/tarball/master" class="tar">tar</a><a href="https://github.com/TechnoGate/contao/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-24079929-5");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

</body>
</html>
